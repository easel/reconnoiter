CC=@CC@
CPPFLAGS=@CPPFLAGS@
CFLAGS=@CFLAGS@
LDFLAGS=@LDFLAGS@
AR=@AR@
RANLIB=@RANLIB@
LIBS=@LIBS@
INSTALL=@INSTALL@

prefix=@prefix@
exec_prefix=@exec_prefix@
bindir=@bindir@
sbindir=@sbindir@
libdir=@libdir@
includedir=${prefix}/include
libexecdir=@libexecdir@
datarootdir = @datarootdir@
mandir=@mandir@
mansubdir=@mansubdir@
docdir=${prefix}/@docdir@
sysconfdir=@sysconfdir@
srcdir=@srcdir@
top_srcdir=@top_srcdir@

SUBS=utils jlog eventer modules

OBJS=noitd.o noit_listener.o noit_console.o noit_poller.o \
	noit_module.o noit_conf.o

all:	noitd

make-subdirs:
	for dir in $(SUBS) ; do \
		(cd $$dir && make) ; \
	done

noitd:	make-subdirs $(OBJS)
	$(CC) -o $@ $(OBJS) \
		$(LDFLAGS) \
		-Leventer -leventer \
		-Lutils -lnoit_utils \
		-Ljlog -ljlog \
		$(LIBS)

.c.o:
	$(CC) $(CPPFLAGS) $(CFLAGS) -c $<

clean-subdirs:
	for dir in $(SUBS) ; do \
		(cd $$dir && make clean) ; \
	done

clean:	clean-subdirs
	rm -f *.o noitd

