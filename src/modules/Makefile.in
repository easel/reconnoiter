.SUFFIXES: .lo .@MODULEEXT@

CC=@CC@
LD=@LD@
CPPFLAGS=@CPPFLAGS@
CFLAGS=@CFLAGS@
PGCFLAGS=@PGCFLAGS@
SHCFLAGS=@SHCFLAGS@
MODULELD=@MODULELD@
MODULEEXT=@MODULEEXT@
LDFLAGS=@LDFLAGS@
AR=@AR@
RANLIB=@RANLIB@
LIBS=@LIBS@
PGLIBS=@PGLIBS@
INSTALL=@INSTALL@

top_srcdir=@top_srcdir@

MODULES=ping_icmp.@MODULEEXT@ http.@MODULEEXT@ postgres.@MODULEEXT@ \
	lua.@MODULEEXT@ \
	@BUILD_MODULES@

all:	$(MODULES)

lua.@MODULEEXT@:	lua.lo lua_noit.lo
	@$(MODULELD) $(LDFLAGS) -o $@ lua.lo lua_noit.lo ../lua/liblua.lo
	@echo "- linking $@"

lua.lo:	lua.c
	@$(CC) $(CPPFLAGS) $(SHCFLAGS) -I$(top_srcdir)/src/lua/src -c lua.c -o $@
	@echo "- compiling $<"

lua_noit.lo:	lua_noit.c
	@$(CC) $(CPPFLAGS) $(SHCFLAGS) -I$(top_srcdir)/src/lua/src -c lua_noit.c -o $@
	@echo "- compiling $<"

postgres.@MODULEEXT@:	postgres.lo
	@$(MODULELD) $(LDFLAGS) -o $@ postgres.lo @SERFLIBS@ $(PGLIBS) -lz -lssl -lcrypto
	@echo "- linking $@"

postgres.lo:	postgres.c
	@$(CC) $(CPPFLAGS) $(SHCFLAGS) $(PGCFLAGS) -c $< -o $@
	@echo "- compiling $<"

http.@MODULEEXT@:	http.lo
	@$(MODULELD) $(LDFLAGS) -o $@ http.lo @SERFLIBS@ ../serf/.libs/libserf-0.o -lz -lssl -lcrypto
	@echo "- linking $@"

http.lo:	http.c
	@$(CC) $(CPPFLAGS) $(SHCFLAGS) -I$(top_srcdir)/src/serf @SERFCFLAGS@ -c http.c -o $@
	@echo "- compiling $<"

snmp.@MODULEEXT@:	snmp.lo
	@$(MODULELD) $(LDFLAGS) -o $@ snmp.lo -lnetsnmp
	@echo "- linking $@"

ssh2.@MODULEEXT@:	ssh2.lo
	@$(MODULELD) $(LDFLAGS) -o $@ ssh2.lo -lssh2
	@echo "- linking $@"

ping_icmp.@MODULEEXT@:	ping_icmp.lo
	@$(MODULELD) $(LDFLAGS) -o $@ $<
	@echo "- linking $@"

.lo.@MODULEEXT@:
	@$(MODULELD) $(LDFLAGS) -o $@ $<
	@echo "- linking $@"

.c.lo:
	@$(CC) $(CPPFLAGS) $(SHCFLAGS) -c $< -o $@
	@echo "- compiling $<"

clean:
	rm -f *.lo *.@MODULEEXT@
