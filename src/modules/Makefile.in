.SUFFIXES: .lo .@MODULEEXT@

CC=@CC@
LD=@LD@
CPPFLAGS=@CPPFLAGS@
CFLAGS=@CFLAGS@
SHCFLAGS=@SHCFLAGS@
MODULELD=@MODULELD@
MODULEEXT=@MODULEEXT@
LDFLAGS=@LDFLAGS@
AR=@AR@
RANLIB=@RANLIB@
LIBS=@LIBS@
INSTALL=@INSTALL@

top_srcdir=@top_srcdir@

MODULES=ping_icmp.@MODULEEXT@ http.@MODULEEXT@ @BUILD_MODULES@

all:	$(MODULES)

http.@MODULEEXT@:	http.lo
	@$(MODULELD) $(LDFLAGS) -o $@ http.lo @SERFLIBS@ ../serf/.libs/libserf-0.a -lz -lssl -lcrypto
	@echo "- linking $@"

http.lo:	http.c
	@$(CC) $(CPPFLAGS) $(SHCFLAGS) -I$(top_srcdir)/src/serf @SERFCFLAGS@ -c http.c -o $@
	@echo "- compiling $<"

snmp.@MODULEEXT@:	snmp.lo
	@$(MODULELD) $(LDFLAGS) -o $@ snmp.lo -lnetsnmp
	@echo "- linking $@"

ssh2.@MODULEEXT@:	ssh2.lo
	@$(MODULELD) $(LDFLAGS) -o $@ ssh2.lo -lssh2
	@echo "- linking $@"

.lo.@MODULEEXT@:
	@$(MODULELD) $(LDFLAGS) -o $@ $<
	@echo "- linking $@"

.c.lo:
	@$(CC) $(CPPFLAGS) $(SHCFLAGS) -c $< -o $@
	@echo "- compiling $<"

clean:
	rm -f *.lo *.@MODULEEXT@
